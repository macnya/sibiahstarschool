type Subject @table(name: "subjects") {
  subjectId: String! @primaryKey @default(expression: "gen_random_uuid()")
  subjectName: String! @unique
  description: String
}

type Class @table(name: "classes") {
  classId: String! @primaryKey @default(expression: "gen_random_uuid()")
  className: String! # e.g., "Grade 5A Mathematics", "PP1 Blue Art"
  gradeLevel: String! # e.g., "Grade 5", "PP1"
  academicYear: String! # e.g., "2024-2025"

  # Relationships
  enrollments: [Enrollment!] @relationship(principalFields: ["classId"], foreignFields: ["classId"])
  teacherAssignments: [TeacherClassAssignment!] @relationship(principalFields: ["classId"], foreignFields: ["classId"])
  grades: [Grade!] @relationship(principalFields: ["classId"], foreignFields: ["classId"])
  exams: [Exam!] @relationship(principalFields: ["classId"], foreignFields: ["classId"])
}

# Students enrolled in classes
type Enrollment @table(name: "enrollments", unique: [["studentId", "classId"]]) {
  enrollmentId: String! @primaryKey @default(expression: "gen_random_uuid()")
  studentId: String! # FK to User table (student's userId)
  classId: String!   # FK to Class table
  enrollmentDate: Date! @default(expression: "CURRENT_DATE")

  student: User! @relationship(principalFields: ["studentId"], foreignFields: ["userId"])
  class: Class! @relationship(principalFields: ["classId"], foreignFields: ["classId"])
}

# Teachers assigned to classes
type TeacherClassAssignment @table(name: "teacher_class_assignments", unique: [["teacherId", "classId"]]) {
  assignmentId: String! @primaryKey @default(expression: "gen_random_uuid()")
  teacherId: String!    # FK to User table (teacher's userId)
  classId: String!      # FK to Class table

  teacher: User! @relationship(principalFields: ["teacherId"], foreignFields: ["userId"])
  class: Class! @relationship(principalFields: ["classId"], foreignFields: ["classId"])
}

type Grade @table(name: "grades") {
  gradeId: String! @primaryKey @default(expression: "gen_random_uuid()")
  studentId: String!   # FK to User table (student's userId)
  classId: String!     # FK to Class table (context of the grade)
  subjectId: String!   # FK to Subject table
  term: String!        # e.g., "Term 1", "Mid-Term", "Final Assignment"
  score: String        # e.g., "A", "85%", or numeric score as string for flexibility
  comments: String
  recordedById: String! # FK to User table (teacher's userId who recorded it)
  recordedAt: Timestamp! @default(expression: "CURRENT_TIMESTAMP")

  student: User! @relationship(principalFields: ["studentId"], foreignFields: ["userId"])
  class: Class! @relationship(principalFields: ["classId"], foreignFields: ["classId"])
  subject: Subject! @relationship(principalFields: ["subjectId"], foreignFields: ["subjectId"])
  recordedBy: User! @relationship(principalFields: ["recordedById"], foreignFields: ["userId"])
}

type Exam @table(name: "exams") {
  examId: String! @primaryKey @default(expression: "gen_random_uuid()")
  examName: String!
  subjectId: String!
  classId: String       # FK to Class table, exam is for this class
  examDate: Date!
  details: String

  subject: Subject! @relationship(principalFields: ["subjectId"], foreignFields: ["subjectId"])
  class: Class! @relationship(principalFields: ["classId"], foreignFields: ["classId"])
}
